# 继续聊this
## 绑定规则
### 默认绑定
```javascript
function foo() {
  console.log(this.a);
}
var a=2;
foo();
```
声明在全局作用域的变量就是全局对象的一个同名属性。

在调用foo()时,this.a被解析成了全局变量a。在上面的例子中，函数调用时应用了this的默认绑定，因此this指向
全局对象。

我们可以通过分析调用位置看foo()如何调用的。foo()是直接使用不带任何修饰的函数引用进行调用的，
因此只能使用默认绑定，无法应用其他规则。

如果使用严格模式，那么全局对象将无法使用默认绑定，因此this会被绑定到undefined。
```javascript
function foo() {
  "use strict"
  console.log(this.a);
}
var a=2;
foo();
```
这里有一个微妙但非常重要的细节，虽然this的绑定规则完全取决于调用位置，但是只有
foo()运行在非严格模式下时，默认绑定才能绑定到全局对象；严格模式下与foo()的调用位置无关。

```javascript
function foo() {
  console.log(this.a);
}
var a=2;
(function () {
  "use strict";
  foo();
})()
```
### 隐式绑定
另一条需要考虑的规则是调用位置是否有上下文对象，或者说是否被某个对象拥有或包含。
```javascript
function foo() {
  console.log(this.a);
}
var obj={
	a:2,
	foo:foo
}
obj.foo();
```
首先需要注意的是foo()的声明方式，及其以后是如何被当作引用属性添加到obj中的。
但是无论是直接在obj中定义还是先定义再添加为引用属性，这个函数严格说来都不属于obj
对象。

然而，调用位置会使用obj上下文来引用函数，因此你可以说函数被调用时obj对象“拥有”或者“包含”它。

无论你如何称呼这个模式，当foo()被调用时，它的落脚点确实指向obj对象。当函数引用有上下文对象时，隐式绑定规则
会把函数调用中的this绑定到这个上下文对象。因为调用foo()时this被绑定到obj，因此this.a与obj.a是一样的。

对象属性引用链中只有最顶层或者最后一层会影响调用位置。
```javascript
function foo() {
  console.log(this.a);
}
var obj2={
	a:42,
	foo:foo
};
var obj1={
	a:2,
	obj2:obj2
};
obj1.obj2.foo();

```
### 隐式丢失
一个最常见的this绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是说它会应用
默认绑定，从而把this绑定到全局对象或undefined上，取决于是否是严格模式。
```javascript
function foo() {
  console.log(this.a);
}
var obj={
	a:2,
	foo:foo
};
var bar=obj.foo;//函数别名
var a="oops,global";
bar();
```
虽然bar是obj.foo的一个引用，实际上它引用的是foo函数本身。因此此时的
bar()其实是一个不带任何修饰的函数调用，因此应用了默认绑定。

```javascript
function foo() {
  console.log(this.a);
}
function doFoo(fn) {
  fn();//调用位置
}
var obj={
	a:2,
	foo:foo
};
var a="oops,global";//a是全局对象的属性
doFoo(obj.foo);
```
参数传递其实就是一种隐式赋值，因此我们传入函数时也会被隐式赋值。

如果把函数传入语言内置的函数而不是传入你自己声明的函数，会发生什么呢？
结果是一样的，没有区别。
```javascript
function foo() {
  console.log(this.a);
}
var obj={
	a:2,
	foo:foo
};
var a="oops,global";
setTimeout(obj.foo,100);
```
## 答案
1 .
```javascript
//2
```

2 .
```javascript
//undefined
``` 

3 .
```javascript
//2
```
4 .
```javascript
//2
``` 

5 .
```javascript
//42
``` 
6 .
```javascript
//"oops,global"
```
7 .
```javascript
//"oops,global"
```

8 .
```javascript
//"oops,global"
```